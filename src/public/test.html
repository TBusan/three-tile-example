<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
        />
        <title>three-tile</title>
    </head>
    <style>
        html,
        body {
            background-color: #333;
            height: 100%;
            width: 100%;
            padding: 0;
            margin: 0;
            display: flex;
        }
        #map {
            flex: 1;
        }
    </style>
    <body>
        <div id="map"></div>
        <script src="./three.js"></script>
        <script src="./three-tile.umd.js"></script>
        <script>
            // import * as tt from "./three-tile.es.js";

            console.log("three-tile start!");

            // MapBoxToken 请更换为你自己申请的key
            const MAPBOXKEY =
                "pk.eyJ1IjoiZ3VvamYiLCJhIjoiY2tlZzBkbDh4MGdwZTJ4cnpweTE5a3A1ayJ9.mQnCskKBn7ni_C7zdSO8Gw";

            // 创建地图
            const map = tt.TileMap.create({
                // 影像数据源
                imgProvider: new tt.MapBoxImgProvider(MAPBOXKEY),
                // 地形数据源
                demProvider: new tt.MapBoxDemProvider(MAPBOXKEY),
                // 地图投影中心经度
                projCenterLon: 90,
                // 最小缩放级别
                minLevel: 2,
                // 最大缩放级别
                maxLevel: 18,
            });
            map.loader.showLoading = false;

            // 地图中心经纬度转为场景坐标
            const center = map.project(108.942, 34.2855);

            const container = document.querySelector("#map");
            const viewer = new tt.plugin.GLViewer(
                container,
                new THREE.Vector3(center.x, center.y, 0),
                new THREE.Vector3(center.x, center.y, 3e4)
            );

            viewer.scene.background.set(0);
            viewer.scene.fog.color = viewer.scene.background;
            viewer.scene.add(map);

            // 添加地图坐标轴
            const helper = new THREE.AxesHelper(1000);
            helper.position.set(center.x, center.y, 1);
            viewer.scene.add(helper);

            // 动画漫游到3500km高空
            (() => {
                const timer = setInterval(() => {
                    const pos = viewer.camera.position;
                    pos.z -= 500;
                    pos.y -= 100;
                    if (pos.z < 3500) {
                        clearInterval(timer);
                    }
                }, 100);
            })();
        </script>
    </body>
</html>
